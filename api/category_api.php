<?phpinclude_once("../includes/connection.php"); switch ($_SERVER['REQUEST_METHOD']) {    case 'GET':	    if(isset($_GET['tag']))		{		       		       $criteria=$_GET['tag'];			   if ($criteria==0)			   {			       //get the 50 most popular books		           $res = mysql_query("SELECT * FROM Tag")or die(mysql_error());		           while ($row = mysql_fetch_assoc($res))		           $array[] = $row;                   if (isset($array)) 			       {				     header('Content-Type:application/json');                     echo json_encode($array);                   }                   else echo "No tag";			   }			   else			   {		             //get the 50 most popular books		            $res = mysql_query("SELECT b.* FROM Book b,Booktag bt where b.b_id=bt.b_id and bt.t_id=$criteria ORDER BY b.popularity DESC")or die(mysql_error());			        while ($row = mysql_fetch_assoc($res))			     	{				       mysql_query(sprintf("UPDATE Book SET popularity=popularity+1 WHERE b_id='%s'",$row['b_id']))or die(mysql_error());			           if ($row['cover_path']==NULL)			           $b=array('type'=>0,'image'=>0);			           else			            {			               $b_id=$row['b_id'];				           $filename='../epubs/'.$b_id.'/'.$row['cover_path'];			               $path=pathinfo('../epubs/'.$b_id.'/'.$row['cover_path']);				           $filetype=$path['extension'];                           if ($filename) 			               {                              $imgbinary = fread(fopen($filename, "r"), filesize($filename));					          $base64 = chunk_split(base64_encode($imgbinary));                              $b=array('type'=>$filetype,'image'=>$base64);			                }			             }		                 header('Content-Type:application/json');			    	     $row=array_merge($b,$row);			    		 $array2[] = $row;			     	}			    	if (isset($array2))		            header('Content-Type:application/json');                    echo json_encode($array2);			   }		}		break;    case 'POST':	        case 'PUT':       break;    case 'DELETE':}?>